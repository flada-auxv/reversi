#!/usr/bin/env ruby

require_relative '../lib/reversi'

require 'stringio'

class ReversiExecuter
  INPUT_FORMAT = /[a-h][1-8]/

  def initialize
    @game = Reversi.new
  end

  def run
    loop do
      print_board

      begin
        @game.move(read_input)
      rescue Reversi::IllegalMovementError
        help
        retry
      end

      puts ''
    end
  end


  private

  def read_input
    print '>> '

    until (input = readline.chomp) =~ INPUT_FORMAT
      help
    end

    input
  end

  def help
    puts 'そこには石を置く事ができません!!'
  end

  def print_board
    puts "turn -> #{@game.current_turn}"
    puts "------------------"
    puts "  a b c d e f g h"

    sio = StringIO.new
    @game.board.each_with_index do |x_line, i|
      sio << "#{i+1}"
      x_line.each do |y|
        sio << '|'
        case y
        when nil
          sio << ' '
        when :black
          sio << "\e[32mb\e[m"
        when :white
          sio << "\e[33mw\e[m"
        end
      end
      sio << "|\n"
    end

    puts sio.string
    puts ''
  end
end

ReversiExecuter.new.run
