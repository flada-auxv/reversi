#!/usr/bin/env ruby

require_relative '../lib/reversi'

require 'stringio'

class ReversiExecuter
  INPUT_FORMAT = /[a-h][1-8]/

  def initialize
    @game = Reversi.new
  end

  def run
    loop do
      print_board

      begin
        @game.move(read_input)
      rescue Reversi::IllegalMovementError
        help
        retry
      end
    end
  end

  def read_input
    until (input = readline.chomp) =~ INPUT_FORMAT
      help
    end

    input
  end

  def help
    p 'hi'
  end

  def print_board
    puts "turn -> #{@game.current_turn}"
    puts "------------------"
    puts "  a b c d e f g h"

    sio = StringIO.new
    @game.board.each_with_index do |x_line, i|
      sio << "#{i+1}"
      x_line.each do |y|
        sio << '|'
        case y
        when nil
          sio << ' '
        when :black
          sio << 'b'
        when :white
          sio << 'w'
        end
      end
      sio << "|\n"
    end

    puts sio.string
    puts ''
  end

  def turn_change
    if @board.turn
      @board.turn = false
    else
      @board.turn = true
    end
  end
end

ReversiExecuter.new.run
